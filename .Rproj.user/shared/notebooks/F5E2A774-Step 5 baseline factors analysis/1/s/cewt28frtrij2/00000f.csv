"0","data_imp <- readRDS(""data/imputation_result_all_60.rds"")"
"0",""
"0","final <- lapply(1:10, function(x) complete(data_imp , x))"
"0","final <- lapply(final, function(x) mutate(x, OS1_event = as.numeric(1 - as.numeric(OS1_CNSR))))"
"0","final <- lapply(final, function(x) mutate(x, across(where(is.factor), ~ factor(.x, ordered = F))))"
"0",""
"0","vars_for_table_imp <- lapply(final, function(df) {"
"0","  colnames(select(df, c(ends_with(""Num0"") | ends_with(""Num1"") |ends_with(""Cat0""), AngiopulmonographyDamageCat1, WHOFuncClassCat1)))"
"0","})"
"0","vars_for_table_imp <- unique(unlist(vars_for_table_imp))"
"0",""
"0","univ_formulas <- lapply(vars_for_table_imp, function(x) as.formula(paste('Surv(OS1, OS1_event) ~', x)))"
"0",""
"0","#Create a list to store the results"
"0","table_imp_list <- list()"
"0",""
"0","for (form in univ_formulas) {"
"0","  models <- lapply(final, function(x) coxph(form, data = x))"
"0","  pooled_results <- tidy(pool(models), conf.int = TRUE) %>%"
"0","    mutate("
"0","      HR = exp(estimate),"
"0","      lower_95 = exp(estimate - 1.96 * std.error),"
"0","      upper_95 = exp(estimate + 1.96 * std.error),"
"0","      HR_with_CI = paste0("
"0","            round(HR, 2), "
"0","            "" ("", "
"0","            round(lower_95, 2), "
"0","            ""-"", "
"0","            round(upper_95, 2), "
"0","            "")"""
"0","          )"
"0","    )"
"0","  table_imp_list <- append(table_imp_list, list(pooled_results))"
"0","}"
"2","Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights,  :"
"2","
 "
"2"," Loglik converged before variable  1,2,3 ; coefficient may be infinite. 
"
"2","Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights,  :"
"2","
 "
"2"," Loglik converged before variable  1,2,3 ; coefficient may be infinite. 
"
"2","Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights,  :"
"2","
 "
"2"," Loglik converged before variable  1,2,3 ; coefficient may be infinite. 
"
"2","Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights,  :"
"2","
 "
"2"," Loglik converged before variable  1,2,3 ; coefficient may be infinite. 
"
"2","Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights,  :"
"2","
 "
"2"," Loglik converged before variable  1,2,3 ; coefficient may be infinite. 
"
"2","Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights,  :"
"2","
 "
"2"," Loglik converged before variable  1,2,3 ; coefficient may be infinite. 
"
"2","Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights,  :"
"2","
 "
"2"," Loglik converged before variable  1,2,3 ; coefficient may be infinite. 
"
"2","Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights,  :"
"2","
 "
"2"," Loglik converged before variable  1,2,3 ; coefficient may be infinite. 
"
"2","Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights,  :"
"2","
 "
"2"," Loglik converged before variable  1,2,3 ; coefficient may be infinite. 
"
"2","Warning in coxph.fit(X, Y, istrat, offset, init, control, weights = weights,  :"
"2","
 "
"2"," Loglik converged before variable  1,2,3 ; coefficient may be infinite. 
"
"0","# Combine the results into one dataframe"
"0","table_imp <- bind_rows(table_imp_list) %>% "
"0","  mutate(raw_p_value = as.character(ifelse(p.value < 0.001, ""<0.001"", round(as.numeric(p.value), 3))),"
"0","      adj_p_value = as.numeric(p.adjust(as.numeric(p.value), method = ""BH"")),"
"0","      adj_p_value = as.character(ifelse(adj_p_value < 0.001, "
"0","                                        ""<0.001"", "
"0","                                        round(adj_p_value, 3))))%>%"
"0","  filter(term != '(Intercept)')"
"0",""
"0","var_labels <- c("
"0","""AgeNum1"" = ""Age"","
"0","""AngiopulmonographyDamageCat1Дистальное поражение"" = ""Angiopulmonography Damage_Yes"","
"0","""AntiCoagDrugCat0Да"" = ""Anticoagulant Therapy_Yes"","
"0","""ApixabanCat0Да"" = ""Apixaban_Yes"","
"0","""BloodBHGlucoseNum1"" = ""Blood Glucose"","
"0","""BloodBHHDLCholesterolNum1"" = ""HDL Cholesterol"","
"0","""BloodBHLDLCholesterolNum1"" = ""LDL Cholesterol"","
"0","""BloodBHTotalCholesterolNum1"" = ""Total Cholesterol"","
"0","""BloodBHTriglyceridesNum1"" = ""Triglycerides"","
"0","""BMINum1"" = ""Body Mass Index"","
"0","""CHFDecompensationCat0Да"" = ""CHF Decompensation_Yes"","
"0","""CPTECat0Да"" = ""CTPE Diagnosis_Yes"","
"0","""CTBPACat0Да"" = ""CTBPA Diagnosis_Yes"","
"0","""DabigatranCat0Да"" = ""Dabigatran_Yes"","
"0","""DiurDrugCat0Да"" = ""Diuretics Therapy_Yes"","
"0","""ECHOCGDZLANum0"" = ""ECHO DZLA"","
"0","""ECHOCGFrontBackSizeNum1"" = ""ECHO Front-Back Size"","
"0","""ECHOCGPericEffusCat0Да"" = ""ECHO Pericardium Effusion_Yes"","
"0","""ECHOCGPPareaNum0"" = ""ECHO PP area"","
"0","""ECHOCGSDLANum0"" = ""ECHO SDL Area"","
"0","""ECHOCGTapseNum0"" = ""ECHO Tapse"","
"0","""ECHOCGTricRegCat0II"" = ""Tricuspid regurgitation_III"","
"0","""ECHOCGTricRegCat0III"" = ""Tricuspid regurgitation_II"","
"0","""ECHOCGTricRegCat0IV"" = ""Tricuspid regurgitation_IV"","
"0","""EnoxaparinCat0Да"" = ""Enoxaparin_Yes"","
"0","""HemoglobinNum1"" = ""Hemoglobin Level"","
"0","""medHist10Cat0ФП или ТП (любая форма)"" = ""Atrial Fibrillation or Flutter_Yes"","
"0","""medHist1Cat0гипертоническая болезнь"" = ""Hypertension_Yes"","
"0","""medHist2Cat0ишемическая болезнь сердца"" = ""Ischemic Heart Disease_Yes"","
"0","""medHist3Cat0хроническая обструктивная болезнь легких"" = ""Chronic Obstructive Pulmonary Disease_Yes"","
"0","""medHist6Cat0антифосфолипидный синдром"" = ""Antiphospholipid Syndrome_Yes"","
"0","""medHist7Cat0системная красная волчанка"" = ""Systemic Lupus Erythematosus_Yes"","
"0","""medHist8Cat0СД или нарушение толерантности к глюкозе"" = ""Diabetes or Impaired Glucose Tolerance_Yes"","
"0","""medHist9Cat0ХБП 3А стадии или выше"" = ""Chronic Kidney Disease Stage 3A or Higher_Yes"","
"0","""MutationCat0Да"" = ""Genetic Mutation_Yes"","
"0","""PulHypSymp2Cat0повышенная утомляемость"" = ""Increased fatigue_Yes"","
"0","""PulHypSymp3Cat0боли в области сердца"" = ""Chest pain_Yes"","
"0","""PulHypSymp4Cat0головокружение"" = ""Dizziness_Yes"","
"0","""PulHypSymp5Cat0синкопальные состояния"" = ""Syncope_Yes"","
"0","""PulHypSymp6Cat0кашель"" = ""Cough_Yes"","
"0","""PulHypSymp7Cat0кровохарканье"" = ""Hemoptysis_Yes"","
"0","""PulHypSymp8Cat0отеки ног"" = ""Leg edema_Yes"","
"0","""RHCatheterCINum1"" = ""RH Catheter CI"","
"0","""RHCatheterDPPmeanNum0"" = ""RH Catheter DPP mean"","
"0","""RHCatheterLCCVudNum1"" = ""RH Catheter LCC Vud"","
"0","""RHCatheterSaO2Num1"" = ""RH Catheter SaO2"","
"0","""RHCatheterSDLANum1"" = ""RH Catheter SDLA"","
"0","""RHCatheterSvO2Num1"" = ""RH Catheter SvO2"","
"0","""RivaroxabanCat0Да"" = ""Rivaroxaban_Yes"","
"0","""SexCat0Женский"" = ""Sex_Female"","
"0","""Test6ApneaBorgNum1"" = ""Apnea Borg Scale"","
"0","""Test6DistNum1"" = ""6-Min Walk Distance"","
"0","""WarfarinCat0Да"" = ""Warfarin_Yes"","
"0","""WHOFuncClassCat1III"" = ""WHO Functional Class_III"","
"0","""WHOFuncClassCat1IV"" = ""WHO Functional Class_IV"")"
"0",""
"0","# Data for the graph"
"0","forest_data_plot_imp <- table_imp %>%"
"0","  mutate("
"0","    HR = as.numeric(sub("" .*"", """", HR_with_CI)),"
"0","    lower_95 = as.numeric(sub("".*\\((.*)-.*\\)"", ""\\1"", HR_with_CI)),"
"0","    upper_95 = as.numeric(sub("".*-(.*)\\)"", ""\\1"", HR_with_CI)),      "
"0","    p_and_adj_p = paste0(""p: "", raw_p_value, ""; adj: "", adj_p_value)     "
"0","  ) %>%"
"0","  arrange(p.value)%>%"
"0","  mutate(term_clean = dplyr::recode(term, !!!var_labels)) %>%"
"0","  slice(1:10)%>% arrange(term_clean)"
"0",""
"0","# signatures"
"0","labeltext_imp <- rbind("
"0","  c(""Covariate"", ""HR (95% CI)"", ""P-values""), "
"0","  forest_data_plot_imp %>% select(term_clean, HR_with_CI, p_and_adj_p) %>% as.matrix()"
"0",")"
"0",""
"0",""
"0","n_rows <- nrow(labeltext_imp) "
"0","mean_values_imp <- c(NA, exp(forest_data_plot_imp$estimate))[1:n_rows]"
"0","lower_values_imp <- c(NA, exp(forest_data_plot_imp$conf.low))[1:n_rows]"
"0","upper_values_imp <- c(NA, exp(forest_data_plot_imp$conf.high))[1:n_rows]"
"0",""
"0","# plot"
"0","plot_forest_imp_death <- forestplot("
"0","  labeltext = labeltext_imp,"
"0","  mean = mean_values_imp,"
"0","  lower = lower_values_imp,"
"0","  upper = upper_values_imp,"
"0","  xlog = TRUE,"
"0","  xlim = c(exp(-4), exp(4)),"
"0","  title = ""Forest Plot for Cox Models for Overall Survival"","
"0","  new_page = TRUE,"
"0","  is.summary = c(TRUE, rep(FALSE, nrow(forest_data_plot_imp))),"
"0","  boxsize = 0.2,"
"0","  col = fpColors(box = ""darkblue"", line = ""black"", summary = ""darkblue""),"
"0","  txt_gp = fpTxtGp("
"0","    label = gpar(cex = 0.8),"
"0","    ticks = gpar(cex = 0.7),"
"0","    xlab = gpar(cex = 0.8)"
"0","  ),"
"0","  align = ""l"","
"0","  clip = c(exp(-4), exp(4)),"
"0","  graph.pos = 2"
"0",")"
