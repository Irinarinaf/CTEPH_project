"0","library(tidyverse)  # Для работы с tibbles и dplyr"
"0",""
"0","create_model_and_get_coefficients_nb <- function(formula, data_set) {"
"0","  "
"0","  # Строим модель"
"0","  model <- glm.nb(formula, data_set)"
"0","  "
"0","  # Получаем коэффициенты модели"
"0","  coefficients <- summary(model)$coef %>% as_tibble(rownames = ""Factors"")"
"0","  "
"0","  # Оставляем нужные столбцы"
"0","  coefficients <- coefficients[, c('Estimate', 'Pr(>|z|)')]"
"0","  "
"0","  # Рассчитываем доверительные интервалы вручную"
"0","  alpha <- 0.05  # Уровень значимости для расчета CI"
"0","  z_crit <- qnorm(1 - alpha/2)  # Критическое значение Z для двустороннего теста"
"0","  std_error <- sqrt(diag(vcov(model)))  # Стандартная ошибка коэффициентов"
"0","  lower_ci <- round(coefficients$Estimate - z_crit * std_error, digits = 2)"
"0","  upper_ci <- round(coefficients$Estimate + z_crit * std_error, digits = 2)"
"0","  coefficients$confidence_intervals <- paste(""("", lower_ci, "", "", upper_ci, "")"", sep = """")"
"0","  "
"0","  # Рассчитываем скорректированные p-значения"
"0","  coefficients$p_adjusted <- p.adjust(coefficients$`Pr(>|z|)`, method = ""BH"")"
"0","  "
"0","  # Переименовываем столбцы"
"0","  colnames(coefficients) <- c('Coefficients_values*', 'p_value*', 'confidence_intervals*', 'p_adjust*')"
"0","  "
"0","  # Добавляем обозначения для коэффициентов"
"0","  coefficients$`Coefficients*` <- paste0(""$\\beta_"", 0:(nrow(coefficients) - 1), ""$"")"
"0","  "
"0","  # Перемещаем столбец Coefficients на первое место"
"0","  coefficients <- coefficients %>% relocate(`Coefficients*`)"
"0","  coefficients <- coefficients %>% relocate(`confidence_intervals*`, .after = `Coefficients_values*`)"
"0","  "
"0","  return(coefficients)"
"0","}"
"0",""
"0",""
"0","# Создаем список данных с коэффициентами для каждой формулы"
"0","coefficient_data_list_nb <- lapply(formulas, create_model_and_get_coefficients_nb, data_set)"
"0",""
"0","# Объединяем все данные в одну таблицу"
"0","combined_table_nb <- do.call(rbind, coefficient_data_list_nb)"
