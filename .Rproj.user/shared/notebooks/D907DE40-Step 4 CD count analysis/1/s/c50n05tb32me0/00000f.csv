"0","var_labels <- c("
"0","""AgeNum1"" = ""Age"","
"0","""AngiopulmonographyDamageCat1Дистальное поражение"" = ""Angiopulmonography Damage_Yes"","
"0","""AntiCoagDrugCat0Да"" = ""Anticoagulant Therapy_Yes"","
"0","""ApixabanCat0Да"" = ""Apixaban_Yes"","
"0","""BloodBHGlucoseNum1"" = ""Blood Glucose"","
"0","""BloodBHHDLCholesterolNum1"" = ""HDL Cholesterol"","
"0","""BloodBHLDLCholesterolNum1"" = ""LDL Cholesterol"","
"0","""BloodBHTotalCholesterolNum1"" = ""Total Cholesterol"","
"0","""BloodBHTriglyceridesNum1"" = ""Triglycerides"","
"0","""BMINum1"" = ""Body Mass Index"","
"0","""CHFDecompensationCat0Да"" = ""CHF Decompensation_Yes"","
"0","""CPTECat0Да"" = ""CTPE Diagnosis_Yes"","
"0","""CTBPACat0Да"" = ""CTBPA Diagnosis_Yes"","
"0","""DabigatranCat0Да"" = ""Dabigatran_Yes"","
"0","""DiurDrugCat0Да"" = ""Diuretics Therapy_Yes"","
"0","""ECHOCGDZLANum0"" = ""ECHO DZLA"","
"0","""ECHOCGFrontBackSizeNum1"" = ""ECHO Front-Back Size"","
"0","""ECHOCGPericEffusCat0Да"" = ""ECHO Pericardium Effusion_Yes"","
"0","""ECHOCGPPareaNum0"" = ""ECHO PP area"","
"0","""ECHOCGSDLANum0"" = ""ECHO SDL Area"","
"0","""ECHOCGTapseNum0"" = ""ECHO Tapse"","
"0","""ECHOCGTricRegCat0II"" = ""Tricuspid regurgitation_III"","
"0","""ECHOCGTricRegCat0III"" = ""Tricuspid regurgitation_II"","
"0","""ECHOCGTricRegCat0IV"" = ""Tricuspid regurgitation_IV"","
"0","""EnoxaparinCat0Да"" = ""Enoxaparin_Yes"","
"0","""HemoglobinNum1"" = ""Hemoglobin Level"","
"0","""medHist10Cat0ФП или ТП (любая форма)"" = ""Atrial Fibrillation or Flutter_Yes"","
"0","""medHist1Cat0гипертоническая болезнь"" = ""Hypertension_Yes"","
"0","""medHist2Cat0ишемическая болезнь сердца"" = ""Ischemic Heart Disease_Yes"","
"0","""medHist3Cat0хроническая обструктивная болезнь легких"" = ""Chronic Obstructive Pulmonary Disease_Yes"","
"0","""medHist6Cat0антифосфолипидный синдром"" = ""Antiphospholipid Syndrome_Yes"","
"0","""medHist7Cat0системная красная волчанка"" = ""Systemic Lupus Erythematosus_Yes"","
"0","""medHist8Cat0СД или нарушение толерантности к глюкозе"" = ""Diabetes or Impaired Glucose Tolerance_Yes"","
"0","""medHist9Cat0ХБП 3А стадии или выше"" = ""Chronic Kidney Disease Stage 3A or Higher_Yes"","
"0","""MutationCat0Да"" = ""Genetic Mutation_Yes"","
"0","""PulHypSymp2Cat0повышенная утомляемость"" = ""Increased fatigue_Yes"","
"0","""PulHypSymp3Cat0боли в области сердца"" = ""Chest pain_Yes"","
"0","""PulHypSymp4Cat0головокружение"" = ""Dizziness_Yes"","
"0","""PulHypSymp5Cat0синкопальные состояния"" = ""Syncope_Yes"","
"0","""PulHypSymp6Cat0кашель"" = ""Cough_Yes"","
"0","""PulHypSymp7Cat0кровохарканье"" = ""Hemoptysis_Yes"","
"0","""PulHypSymp8Cat0отеки ног"" = ""Leg edema_Yes"","
"0","""RHCatheterCINum1"" = ""RH Catheter CI"","
"0","""RHCatheterDPPmeanNum0"" = ""RH Catheter DPP mean"","
"0","""RHCatheterLCCVudNum1"" = ""RH Catheter LCC"
"0","Vud"","
"0","""RHCatheterSaO2Num1"" = ""RH Catheter SaO2"","
"0","""RHCatheterSDLANum1"" = ""RH Catheter SDLA"","
"0","""RHCatheterSvO2Num1"" = ""RH Catheter SvO2"","
"0","""RivaroxabanCat0Да"" = ""Rivaroxaban_Yes"","
"0","""SexCat0Женский"" = ""Sex_Female"","
"0","""Test6ApneaBorgNum1"" = ""Apnea Borg Scale"","
"0","""Test6DistNum1"" = ""6-Min Walk Distance"","
"0","""WarfarinCat0Да"" = ""Warfarin_Yes"","
"0","""WHOFuncClassCat1III"" = ""WHO Functional Class_III"","
"0","""WHOFuncClassCat1IV"" = ""WHO Functional Class_IV"")"
"0",""
"0",""
"0","final <- lapply(1:10, function(x) complete(data_imp , x))"
"0","final <- lapply(final, function(x) mutate(x, across(where(is.factor), ~ factor(.x, ordered = F))))"
"0",""
"0",""
"0","vars_for_table_imp <- lapply(final, function(df) {"
"0","  select(df, matches(""Num0$|Num1$|Cat0$""), AngiopulmonographyDamageCat1, WHOFuncClassCat1) %>%"
"0","    colnames()"
"0","})"
"0",""
"0",""
"0","vars_for_table_imp <- unique(unlist(vars_for_table_imp))"
"0",""
"0",""
"0","univ_formulas <- sapply(vars_for_table_imp[2:length(vars_for_table_imp)], function(x) as.formula(paste('clin_det_count ~', x, '+ offset(log(OS1))')))"
"0",""
"0","univ_formulas <- lapply(vars_for_table_imp, function(x) as.formula(paste('clin_det_count ~', x, '+ offset(log(OS1))')))"
"0",""
"0","# Создаем список для хранения результатов"
"0","table_imp_list <- list()"
"0",""
"0","for (form in univ_formulas) {"
"0","  models <- lapply(final, function(x) glm.nb(form, data = x))"
"0","  pooled_results <- tidy(pool(models), conf.int = TRUE) %>%"
"0","    mutate("
"0","      RR = exp(estimate),"
"0","      conf.low = exp(conf.low),"
"0","      conf.high = exp(conf.high),"
"0","      RR_with_CI = paste0("
"0","        round(RR, 2), "
"0","        "" ("", "
"0","        round(conf.low, 2), "
"0","        ""-"", "
"0","        round(conf.high, 2), "
"0","        "")"""
"0","      ))"
"0","  table_imp_list <- append(table_imp_list, list(pooled_results))"
"0","}"
"0",""
"0","# Объединяем результаты в один датафрейм"
"0","table_imp <- bind_rows(table_imp_list) %>% filter(term != '(Intercept)')"
"0",""
"0","# Данные для графика"
"0","forest_data_plot_imp <- table_imp %>%"
"0","  mutate("
"0","     raw_p_value = as.character(ifelse(p.value < 0.001, ""<0.001"", round(as.numeric(p.value), 3))),"
"0","      adj_p_value = as.character(ifelse(p.adjust(as.numeric(p.value), method = ""BH"") < 0.001, "
"0","                                        ""<0.001"", "
"0","                                        round(p.adjust(as.numeric(p.value), method = ""BH""), 3))),"
"0","    RR = as.numeric(sub("" .*"", """", RR_with_CI)), # Извлекаем RR"
"0","    lower_95 = as.numeric(sub("".*\\((.*)-.*\\)"", ""\\1"", RR_with_CI)), # Извлекаем lower CI"
"0","    upper_95 = as.numeric(sub("".*-(.*)\\)"", ""\\1"", RR_with_CI)),      # Извлекаем upper CI"
"0","    p_and_adj_p = paste0(""p: "", raw_p_value, ""; adj: "", adj_p_value)      # Объединяем p-value"
"0","  ) %>%"
"0","  arrange(p.value)"
"0",""
"0","# Обновляем подписи переменных в таблице перед визуализацией"
"0","forest_data_plot_imp <- forest_data_plot_imp %>%"
"0","  mutate(term_clean = recode(term, !!!var_labels)) %>%  # Меняем на читаемые названия"
"0","  slice(1:10)"
"0",""
"0","# Создаем таблицу для подписей"
"0","labeltext_imp <- rbind("
"0","  c(""Covariate"", ""RR (95% CI)"", ""P-values""),  # Заголовок"
"0","  forest_data_plot_imp %>% select(term_clean, RR_with_CI, p_and_adj_p) %>% as.matrix()"
"0",")"
"0",""
"0",""
"0","mean_values_imp <- forest_data_plot_imp$RR"
"0","lower_values_imp <- forest_data_plot_imp$lower_95"
"0","upper_values_imp <- forest_data_plot_imp$upper_95"
"0",""
"0","forestplot::forestplot("
"0","  labeltext = labeltext_imp,"
"0","  mean = c(NA, mean_values_imp), "
"0","  lower = c(NA, lower_values_imp),"
"0","  upper = c(NA, upper_values_imp),"
"0","  xlog = TRUE,"
"0","  xlim = c(0.01, 100),"
"0","  title = ""Forest Plot for Negative Binomial Univariate Models for Deterioration-free Survival"","
"0","  new_page = TRUE,"
"0","  is.summary = c(TRUE, rep(FALSE, nrow(forest_data_plot_imp))),"
"0","  boxsize = 0.2,"
"0","  col = fpColors(box = ""darkblue"", line = ""black"", summary = ""darkblue""),"
"0","  txt_gp = fpTxtGp("
"0","    label = gpar(cex = 0.8),"
"0","    ticks = gpar(cex = 0.7),"
"0","    xlab = gpar(cex = 0.8)"
"0","  ),"
"0","  align = ""l"","
"0","  clip = c(0.01, 100),"
"0","  graph.pos = 2"
"0",")"
