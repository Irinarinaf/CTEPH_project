"0","library(tidyverse)  # Для работы с tibbles и dplyr"
"0",""
"0","create_model_and_get_coefficients <- function(formula, data_set, family = 'poisson') {"
"0","  "
"0","  # Строим модель"
"0","  model <- glm(formula, data_set, family = family)"
"0","  "
"0","  # Получаем коэффициенты модели"
"0","  coefficients <- summary(model)$coef %>% as_tibble(rownames = ""Factors"")"
"0","  "
"0","  # Оставляем нужные столбцы"
"0","  coefficients <- coefficients[, c('Factors', 'Estimate', 'Pr(>|z|)')]"
"0","  "
"0","  # Рассчитываем доверительные интервалы вручную"
"0","  alpha <- 0.05  # Уровень значимости для расчета CI"
"0","  z_crit <- qnorm(1 - alpha/2)  # Критическое значение Z для двустороннего теста"
"0","  std_error <- sqrt(diag(vcov(model)))  # Стандартная ошибка коэффициентов"
"0","  lower_ci <- round(coefficients$Estimate - z_crit * std_error, digits = 2)"
"0","  upper_ci <- round(coefficients$Estimate + z_crit * std_error, digits = 2)"
"0","  coefficients$confidence_intervals <- paste(""("", lower_ci, "", "", upper_ci, "")"", sep = """")"
"0","  "
"0","  # Рассчитываем скорректированные p-значения"
"0","  coefficients$p_adjusted <- p.adjust(coefficients$`Pr(>|z|)`, method = ""BH"")"
"0","  "
"0","  # Переименовываем столбцы"
"0","  colnames(coefficients) <- c('Factors', 'Coefficients_values', 'p_value', 'confidence_intervals', 'p_adjust')"
"0","  "
"0","  # Добавляем обозначения для коэффициентов"
"0","  coefficients$Coefficients <- paste0(""$\\beta_"", 0:(nrow(coefficients) - 1), ""$"")"
"0","  "
"0","  # Перемещаем столбец Coefficients на первое место"
"0","  coefficients <- coefficients %>% relocate(Coefficients, .after = Factors)"
"0","  coefficients <- coefficients %>% relocate(confidence_intervals, .after = Coefficients_values)"
"0","  "
"0","  return(coefficients)"
"0","}"
"0",""
"0","# Список формул для моделей"
"0","formulas <- list("
"0","  clin_det_count ~ MutationCat0 + offset(log(OS1)),"
"0","  clin_det_count ~ WHOFuncClassCat2 + offset(log(OS1)),"
"0","  clin_det_count ~ Test6DistCat1 + offset(log(OS1)),"
"0","  clin_det_count ~ Test6ApneaBorgCat1 + offset(log(OS1)),"
"0","  clin_det_count ~ Test6PulsOxBeforeCat1 + offset(log(OS1)),"
"0","  clin_det_count ~ Test6PulsOxAfterCat1 + offset(log(OS1)),"
"0","  clin_det_count ~ CHFDecompensationCat0 + offset(log(OS1)),"
"0","  clin_det_count ~ HemoglobinCat1 + offset(log(OS1)),"
"0","  clin_det_count ~ BNPCat1 + offset(log(OS1)),"
"0","  clin_det_count ~ ECHOCGSDLACat1 + offset(log(OS1)),"
"0","  clin_det_count ~ ECHOCGFrontBackSizeCat1 + offset(log(OS1)),"
"0","  clin_det_count ~ RHCatheterLCCVudCat1 + offset(log(OS1)),"
"0","  clin_det_count ~ RHCatheterSaO2Cat1 + offset(log(OS1)),"
"0","  clin_det_count ~ RHCatheterSvO2Cat1 + offset(log(OS1)),"
"0","  clin_det_count ~ RHCatheterCICat1 + offset(log(OS1)),"
"0","  clin_det_count ~ AngiopulmonographyDamageCat1 + offset(log(OS1)),"
"0","  clin_det_count ~ CPTECat0 + offset(log(OS1)), "
"0","  clin_det_count ~ AntiCoagDrugCat0 + offset(log(OS1)), "
"0","  clin_det_count ~ DiurDrugCat0 + offset(log(OS1)),"
"0","  clin_det_count ~ BloodBHTotalCholesterolCat1 + offset(log(OS1)), "
"0","  clin_det_count ~ BloodBHTriglyceridesCat1 + offset(log(OS1)),"
"0","  clin_det_count ~ BloodBHLDLtoHDLCat1 + offset(log(OS1)), "
"0","  clin_det_count ~ BloodBHUricAcidCat1 + offset(log(OS1)), "
"0","  clin_det_count ~ BloodBHGlucoseCat1 + offset(log(OS1)), "
"0","  clin_det_count ~ PulHypSymp2Cat0 + offset(log(OS1)), "
"0","  clin_det_count ~ PulHypSymp3Cat0 + offset(log(OS1)), "
"0","  clin_det_count ~ PulHypSymp4Cat0 + offset(log(OS1)), "
"0","  clin_det_count ~ PulHypSymp5Cat0 + offset(log(OS1)),"
"0","  clin_det_count ~ PulHypSymp6Cat0 + offset(log(OS1)), "
"0","  clin_det_count ~ PulHypSymp7Cat0 + offset(log(OS1)),"
"0","  clin_det_count ~ PulHypSymp8Cat0 + offset(log(OS1)), "
"0","  clin_det_count ~ medHist1Cat0 + offset(log(OS1)),"
"0","  clin_det_count ~ medHist2Cat0 + offset(log(OS1)),"
"0","  clin_det_count ~ medHist3Cat0 + offset(log(OS1)), "
"0","  clin_det_count ~ medHist4Cat0 + offset(log(OS1)), "
"0","  clin_det_count ~ medHist5Cat0 + offset(log(OS1)), "
"0","  clin_det_count ~ medHist6Cat0 + offset(log(OS1)), "
"0","  clin_det_count ~ medHist7Cat0 + offset(log(OS1)),"
"0","  clin_det_count ~ medHist8Cat0 + offset(log(OS1)), "
"0","  clin_det_count ~ medHist9Cat0 + offset(log(OS1)),"
"0","  clin_det_count ~ medHist10Cat0 + offset(log(OS1))"
"0",")"
"0",""
"0","# Создаем список данных с коэффициентами для каждой формулы"
"0","coefficient_data_list <- lapply(formulas, create_model_and_get_coefficients, data_set)"
"0",""
"0","# Объединяем все данные в одну таблицу"
"0","combined_table_poisson <- do.call(rbind, coefficient_data_list)"
"0",""
