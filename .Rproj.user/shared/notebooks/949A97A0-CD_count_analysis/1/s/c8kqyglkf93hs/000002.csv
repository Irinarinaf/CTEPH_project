"1","
<!-- rnb-source-begin eyJkYXRhIjoiYGBgclxuXG5maW5hbCA8LSBsYXBwbHkoMToxMCwgZnVuY3Rpb24oeCkgY29tcGxldGUoZGF0YV9pbXAgLCB4KSlcbmZpbmFsIDwtIGxhcHBseShmaW5hbCwgZnVuY3Rpb24oeCkgbXV0YXRlKHgsIFRUQ0RfZXZlbnQgPSBhcy5udW1lcmljKFRUQ0RfZXZlbnQpKSlcbmZpbmFsIDwtIGxhcHBseShmaW5hbCwgZnVuY3Rpb24oeCkgbXV0YXRlKHgsIGFjcm9zcyh3aGVyZShpcy5mYWN0b3IpLCB+IGZhY3RvcigueCwgb3JkZXJlZCA9IEYpKSkpXG5cblxudmFyc19mb3JfdGFibGVfaW1wIDwtIGxhcHBseShmaW5hbCwgZnVuY3Rpb24oZGYpIHtcbiAgc2VsZWN0KGRmLCBtYXRjaGVzKFwiTnVtMCR8TnVtMSR8Q2F0MCRcIiksIEFuZ2lvcHVsbW9ub2dyYXBoeURhbWFnZUNhdDEsIFdIT0Z1bmNDbGFzc0NhdDEpICU+JVxuICAgIGNvbG5hbWVzKClcbn0pXG5cblxudmFyc19mb3JfdGFibGVfaW1wIDwtIHVuaXF1ZSh1bmxpc3QodmFyc19mb3JfdGFibGVfaW1wKSlcblxuXG51bml2X2Zvcm11bGFzIDwtIHNhcHBseSh2YXJzX2Zvcl90YWJsZV9pbXBbMjpsZW5ndGgodmFyc19mb3JfdGFibGVfaW1wKV0sIGZ1bmN0aW9uKHgpIGFzLmZvcm11bGEocGFzdGUoJ2NsaW5fZGV0X2NvdW50IH4nLCB4LCAnKyBvZmZzZXQobG9nKE9TMSkpJykpKVxuXG51bml2X2Zvcm11bGFzIDwtIGxhcHBseSh2YXJzX2Zvcl90YWJsZV9pbXAsIGZ1bmN0aW9uKHgpIGFzLmZvcm11bGEocGFzdGUoJ2NsaW5fZGV0X2NvdW50IH4nLCB4LCAnKyBvZmZzZXQobG9nKE9TMSkpJykpKVxuXG4jINCh0L7Qt9C00LDQtdC8INGB0L/QuNGB0L7QuiDQtNC70Y8g0YXRgNCw0L3QtdC90LjRjyDRgNC10LfRg9C70YzRgtCw0YLQvtCyXG50YWJsZV9pbXBfbGlzdCA8LSBsaXN0KClcblxuZm9yIChmb3JtIGluIHVuaXZfZm9ybXVsYXMpIHtcbiAgbW9kZWxzIDwtIGxhcHBseShmaW5hbCwgZnVuY3Rpb24oeCkgZ2xtLm5iKGZvcm0sIGRhdGEgPSB4KSlcbiAgcG9vbGVkX3Jlc3VsdHMgPC0gdGlkeShwb29sKG1vZGVscyksIGNvbmYuaW50ID0gVFJVRSkgJT4lXG4gICAgbXV0YXRlKFxuICAgICAgUlIgPSBleHAoZXN0aW1hdGUpLFxuICAgICAgY29uZi5sb3cgPSBleHAoY29uZi5sb3cpLFxuICAgICAgY29uZi5oaWdoID0gZXhwKGNvbmYuaGlnaCksXG4gICAgICBSUl93aXRoX0NJID0gcGFzdGUwKFxuICAgICAgICByb3VuZChSUiwgMiksIFxuICAgICAgICBcIiAoXCIsIFxuICAgICAgICByb3VuZChjb25mLmxvdywgMiksIFxuICAgICAgICBcIi1cIiwgXG4gICAgICAgIHJvdW5kKGNvbmYuaGlnaCwgMiksIFxuICAgICAgICBcIilcIlxuICAgICAgKSlcbiAgdGFibGVfaW1wX2xpc3QgPC0gYXBwZW5kKHRhYmxlX2ltcF9saXN0LCBsaXN0KHBvb2xlZF9yZXN1bHRzKSlcbn1cblxuIyDQntCx0YrQtdC00LjQvdGP0LXQvCDRgNC10LfRg9C70YzRgtCw0YLRiyDQsiDQvtC00LjQvSDQtNCw0YLQsNGE0YDQtdC50LxcbnRhYmxlX2ltcCA8LSBiaW5kX3Jvd3ModGFibGVfaW1wX2xpc3QpICU+JSBmaWx0ZXIodGVybSAhPSAnKEludGVyY2VwdCknKVxuXG4jINCU0LDQvdC90YvQtSDQtNC70Y8g0LPRgNCw0YTQuNC60LBcbmZvcmVzdF9kYXRhX3Bsb3RfaW1wIDwtIHRhYmxlX2ltcCAlPiVcbiAgbXV0YXRlKFxuICAgICByYXdfcF92YWx1ZSA9IGFzLmNoYXJhY3RlcihpZmVsc2UocC52YWx1ZSA8IDAuMDAxLCBcIjwwLjAwMVwiLCByb3VuZChhcy5udW1lcmljKHAudmFsdWUpLCAzKSkpLFxuICAgICAgYWRqX3BfdmFsdWUgPSBhcy5jaGFyYWN0ZXIoaWZlbHNlKHAuYWRqdXN0KGFzLm51bWVyaWMocC52YWx1ZSksIG1ldGhvZCA9IFwiQkhcIikgPCAwLjAwMSwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgXCI8MC4wMDFcIiwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91bmQocC5hZGp1c3QoYXMubnVtZXJpYyhwLnZhbHVlKSwgbWV0aG9kID0gXCJCSFwiKSwgMykpKSxcbiAgICBSUiA9IGFzLm51bWVyaWMoc3ViKFwiIC4qXCIsIFwiXCIsIFJSX3dpdGhfQ0kpKSwgIyDQmNC30LLQu9C10LrQsNC10LwgUlJcbiAgICBsb3dlcl85NSA9IGFzLm51bWVyaWMoc3ViKFwiLipcXFxcKCguKiktLipcXFxcKVwiLCBcIlxcXFwxXCIsIFJSX3dpdGhfQ0kpKSwgIyDQmNC30LLQu9C10LrQsNC10LwgbG93ZXIgQ0lcbiAgICB1cHBlcl85NSA9IGFzLm51bWVyaWMoc3ViKFwiLiotKC4qKVxcXFwpXCIsIFwiXFxcXDFcIiwgUlJfd2l0aF9DSSkpLCAgICAgICMg0JjQt9Cy0LvQtdC60LDQtdC8IHVwcGVyIENJXG4gICAgcF9hbmRfYWRqX3AgPSBwYXN0ZTAoXCJwOiBcIiwgcmF3X3BfdmFsdWUsIFwiOyBhZGo6IFwiLCBhZGpfcF92YWx1ZSkgICAgICAjINCe0LHRitC10LTQuNC90Y/QtdC8IHAtdmFsdWVcbiAgKSAlPiVcbiAgYXJyYW5nZShwLnZhbHVlKVxuXG4jINCe0LHQvdC+0LLQu9GP0LXQvCDQv9C+0LTQv9C40YHQuCDQv9C10YDQtdC80LXQvdC90YvRhSDQsiDRgtCw0LHQu9C40YbQtSDQv9C10YDQtdC0INCy0LjQt9GD0LDQu9C40LfQsNGG0LjQtdC5XG5mb3Jlc3RfZGF0YV9wbG90X2ltcCA8LSBmb3Jlc3RfZGF0YV9wbG90X2ltcCAlPiVcbiAgbXV0YXRlKHRlcm1fY2xlYW4gPSByZWNvZGUodGVybSwgISEhdmFyX2xhYmVscykpICU+JSAgIyDQnNC10L3Rj9C10Lwg0L3QsCDRh9C40YLQsNC10LzRi9C1INC90LDQt9Cy0LDQvdC40Y9cbiAgc2xpY2UoMToxMClcblxuIyDQodC+0LfQtNCw0LXQvCDRgtCw0LHQu9C40YbRgyDQtNC70Y8g0L/QvtC00L/QuNGB0LXQuVxubGFiZWx0ZXh0X2ltcCA8LSByYmluZChcbiAgYyhcIkNvdmFyaWF0ZVwiLCBcIlJSICg5NSUgQ0kpXCIsIFwiUC12YWx1ZXNcIiksICAjINCX0LDQs9C+0LvQvtCy0L7QulxuICBmb3Jlc3RfZGF0YV9wbG90X2ltcCAlPiUgc2VsZWN0KHRlcm1fY2xlYW4sIFJSX3dpdGhfQ0ksIHBfYW5kX2Fkal9wKSAlPiUgYXMubWF0cml4KClcbilcblxuXG5tZWFuX3ZhbHVlc19pbXAgPC0gZm9yZXN0X2RhdGFfcGxvdF9pbXAkUlJcbmxvd2VyX3ZhbHVlc19pbXAgPC0gZm9yZXN0X2RhdGFfcGxvdF9pbXAkbG93ZXJfOTVcbnVwcGVyX3ZhbHVlc19pbXAgPC0gZm9yZXN0X2RhdGFfcGxvdF9pbXAkdXBwZXJfOTVcblxuZm9yZXN0cGxvdDo6Zm9yZXN0cGxvdChcbiAgbGFiZWx0ZXh0ID0gbGFiZWx0ZXh0X2ltcCxcbiAgbWVhbiA9IGMoTkEsIG1lYW5fdmFsdWVzX2ltcCksIFxuICBsb3dlciA9IGMoTkEsIGxvd2VyX3ZhbHVlc19pbXApLFxuICB1cHBlciA9IGMoTkEsIHVwcGVyX3ZhbHVlc19pbXApLFxuICB4bG9nID0gVFJVRSxcbiAgeGxpbSA9IGMoMC4wMSwgMTAwKSxcbiAgdGl0bGUgPSBcIkZvcmVzdCBQbG90IGZvciBOZWdhdGl2ZSBCaW5vbWlhbCBVbml2YXJpYXRlIE1vZGVscyBmb3IgRGV0ZXJpb3JhdGlvbi1mcmVlIFN1cnZpdmFsXCIsXG4gIG5ld19wYWdlID0gVFJVRSxcbiAgaXMuc3VtbWFyeSA9IGMoVFJVRSwgcmVwKEZBTFNFLCBucm93KGZvcmVzdF9kYXRhX3Bsb3RfaW1wKSkpLFxuICBib3hzaXplID0gMC4yLFxuICBjb2wgPSBmcENvbG9ycyhib3ggPSBcImRhcmtibHVlXCIsIGxpbmUgPSBcImJsYWNrXCIsIHN1bW1hcnkgPSBcImRhcmtibHVlXCIpLFxuICB0eHRfZ3AgPSBmcFR4dEdwKFxuICAgIGxhYmVsID0gZ3BhcihjZXggPSAwLjgpLFxuICAgIHRpY2tzID0gZ3BhcihjZXggPSAwLjcpLFxuICAgIHhsYWIgPSBncGFyKGNleCA9IDAuOClcbiAgKSxcbiAgYWxpZ24gPSBcImxcIixcbiAgY2xpcCA9IGMoMC4wMSwgMTAwKSxcbiAgZ3JhcGgucG9zID0gMlxuKVxuYGBgIn0= -->

```r

final <- lapply(1:10, function(x) complete(data_imp , x))
final <- lapply(final, function(x) mutate(x, TTCD_event = as.numeric(TTCD_event)))
final <- lapply(final, function(x) mutate(x, across(where(is.factor), ~ factor(.x, ordered = F))))


vars_for_table_imp <- lapply(final, function(df) {
  select(df, matches(\"Num0$|Num1$|Cat0$\"), AngiopulmonographyDamageCat1, WHOFuncClassCat1) %>%
    colnames()
})


vars_for_table_imp <- unique(unlist(vars_for_table_imp))


univ_formulas <- sapply(vars_for_table_imp[2:length(vars_for_table_imp)], function(x) as.formula(paste('clin_det_count ~', x, '+ offset(log(OS1))')))

univ_formulas <- lapply(vars_for_table_imp, function(x) as.formula(paste('clin_det_count ~', x, '+ offset(log(OS1))')))

# Создаем список для хранения результатов
table_imp_list <- list()

for (form in univ_formulas) {
  models <- lapply(final, function(x) glm.nb(form, data = x))
  pooled_results <- tidy(pool(models), conf.int = TRUE) %>%
    mutate(
      RR = exp(estimate),
      conf.low = exp(conf.low),
      conf.high = exp(conf.high),
      RR_with_CI = paste0(
        round(RR, 2), 
        \" (\", 
        round(conf.low, 2), 
        \"-\", 
        round(conf.high, 2), 
        \")\"
      ))
  table_imp_list <- append(table_imp_list, list(pooled_results))
}

# Объединяем результаты в один датафрейм
table_imp <- bind_rows(table_imp_list) %>% filter(term != '(Intercept)')

# Данные для графика
forest_data_plot_imp <- table_imp %>%
  mutate(
     raw_p_value = as.character(ifelse(p.value < 0.001, \"<0.001\", round(as.numeric(p.value), 3))),
      adj_p_value = as.character(ifelse(p.adjust(as.numeric(p.value), method = \"BH\") < 0.001, 
                                        \"<0.001\", 
                                        round(p.adjust(as.numeric(p.value), method = \"BH\"), 3))),
    RR = as.numeric(sub(\" .*\", \"\", RR_with_CI)), # Извлекаем RR
    lower_95 = as.numeric(sub(\".*\\((.*)-.*\\)\", \"\\1\", RR_with_CI)), # Извлекаем lower CI
    upper_95 = as.numeric(sub(\".*-(.*)\\)\", \"\\1\", RR_with_CI)),      # Извлекаем upper CI
    p_and_adj_p = paste0(\"p: \", raw_p_value, \"; adj: \", adj_p_value)      # Объединяем p-value
  ) %>%
  arrange(p.value)

# Обновляем подписи переменных в таблице перед визуализацией
forest_data_plot_imp <- forest_data_plot_imp %>%
  mutate(term_clean = recode(term, !!!var_labels)) %>%  # Меняем на читаемые названия
  slice(1:10)

# Создаем таблицу для подписей
labeltext_imp <- rbind(
  c(\"Covariate\", \"RR (95% CI)\", \"P-values\"),  # Заголовок
  forest_data_plot_imp %>% select(term_clean, RR_with_CI, p_and_adj_p) %>% as.matrix()
)


mean_values_imp <- forest_data_plot_imp$RR
lower_values_imp <- forest_data_plot_imp$lower_95
upper_values_imp <- forest_data_plot_imp$upper_95

forestplot::forestplot(
  labeltext = labeltext_imp,
  mean = c(NA, mean_values_imp), 
  lower = c(NA, lower_values_imp),
  upper = c(NA, upper_values_imp),
  xlog = TRUE,
  xlim = c(0.01, 100),
  title = \"Forest Plot for Negative Binomial Univariate Models for Deterioration-free Survival\",
  new_page = TRUE,
  is.summary = c(TRUE, rep(FALSE, nrow(forest_data_plot_imp))),
  boxsize = 0.2,
  col = fpColors(box = \"darkblue\", line = \"black\", summary = \"darkblue\"),
  txt_gp = fpTxtGp(
    label = gpar(cex = 0.8),
    ticks = gpar(cex = 0.7),
    xlab = gpar(cex = 0.8)
  ),
  align = \"l\",
  clip = c(0.01, 100),
  graph.pos = 2
)
```

<!-- rnb-source-end -->
"
"0","```r

final <- lapply(1:10, function(x) complete(data_imp , x))
final <- lapply(final, function(x) mutate(x, TTCD_event = as.numeric(TTCD_event)))
final <- lapply(final, function(x) mutate(x, across(where(is.factor), ~ factor(.x, ordered = F))))


vars_for_table_imp <- lapply(final, function(df) {
  select(df, matches(\"Num0$|Num1$|Cat0$\"), AngiopulmonographyDamageCat1, WHOFuncClassCat1) %>%
    colnames()
})


vars_for_table_imp <- unique(unlist(vars_for_table_imp))


univ_formulas <- sapply(vars_for_table_imp[2:length(vars_for_table_imp)], function(x) as.formula(paste('clin_det_count ~', x, '+ offset(log(OS1))')))

univ_formulas <- lapply(vars_for_table_imp, function(x) as.formula(paste('clin_det_count ~', x, '+ offset(log(OS1))')))

# Создаем список для хранения результатов
table_imp_list <- list()

for (form in univ_formulas) {
  models <- lapply(final, function(x) glm.nb(form, data = x))
  pooled_results <- tidy(pool(models), conf.int = TRUE) %>%
    mutate(
      RR = exp(estimate),
      conf.low = exp(conf.low),
      conf.high = exp(conf.high),
      RR_with_CI = paste0(
        round(RR, 2), 
        \" (\", 
        round(conf.low, 2), 
        \"-\", 
        round(conf.high, 2), 
        \")\"
      ))
  table_imp_list <- append(table_imp_list, list(pooled_results))
}

# Объединяем результаты в один датафрейм
table_imp <- bind_rows(table_imp_list) %>% filter(term != '(Intercept)')

# Данные для графика
forest_data_plot_imp <- table_imp %>%
  mutate(
     raw_p_value = as.character(ifelse(p.value < 0.001, \"<0.001\", round(as.numeric(p.value), 3))),
      adj_p_value = as.character(ifelse(p.adjust(as.numeric(p.value), method = \"BH\") < 0.001, 
                                        \"<0.001\", 
                                        round(p.adjust(as.numeric(p.value), method = \"BH\"), 3))),
    RR = as.numeric(sub(\" .*\", \"\", RR_with_CI)), # Извлекаем RR
    lower_95 = as.numeric(sub(\".*\\((.*)-.*\\)\", \"\\1\", RR_with_CI)), # Извлекаем lower CI
    upper_95 = as.numeric(sub(\".*-(.*)\\)\", \"\\1\", RR_with_CI)),      # Извлекаем upper CI
    p_and_adj_p = paste0(\"p: \", raw_p_value, \"; adj: \", adj_p_value)      # Объединяем p-value
  ) %>%
  arrange(p.value)

# Обновляем подписи переменных в таблице перед визуализацией
forest_data_plot_imp <- forest_data_plot_imp %>%
  mutate(term_clean = recode(term, !!!var_labels)) %>%  # Меняем на читаемые названия
  slice(1:10)

# Создаем таблицу для подписей
labeltext_imp <- rbind(
  c(\"Covariate\", \"RR (95% CI)\", \"P-values\"),  # Заголовок
  forest_data_plot_imp %>% select(term_clean, RR_with_CI, p_and_adj_p) %>% as.matrix()
)


mean_values_imp <- forest_data_plot_imp$RR
lower_values_imp <- forest_data_plot_imp$lower_95
upper_values_imp <- forest_data_plot_imp$upper_95

forestplot::forestplot(
  labeltext = labeltext_imp,
  mean = c(NA, mean_values_imp), 
  lower = c(NA, lower_values_imp),
  upper = c(NA, upper_values_imp),
  xlog = TRUE,
  xlim = c(0.01, 100),
  title = \"Forest Plot for Negative Binomial Univariate Models for Deterioration-free Survival\",
  new_page = TRUE,
  is.summary = c(TRUE, rep(FALSE, nrow(forest_data_plot_imp))),
  boxsize = 0.2,
  col = fpColors(box = \"darkblue\", line = \"black\", summary = \"darkblue\"),
  txt_gp = fpTxtGp(
    label = gpar(cex = 0.8),
    ticks = gpar(cex = 0.7),
    xlab = gpar(cex = 0.8)
  ),
  align = \"l\",
  clip = c(0.01, 100),
  graph.pos = 2
)
```"
"1","
<!-- rnb-plot-begin eyJoZWlnaHQiOjQsIndpZHRoIjo3LCJzaXplX2JlaGF2aW9yIjoxLCJjb25kaXRpb25zIjpbXX0= -->

<img src=\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA0gAAAHgCAMAAACo6b1DAAAAA1BMVEX///+nxBvIAAAACXBIWXMAABJ0AAASdAHeZh94AAABnklEQVR4nO3BAQ0AAADCoPdPbQ43oAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA+DCk6AAELy4lsAAAAAElFTkSuQmCC\" />

<!-- rnb-plot-end -->
"
